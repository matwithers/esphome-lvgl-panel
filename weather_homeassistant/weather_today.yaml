---
# Weather for today from Home Assistant
#
# vars:
#   size: icon size (e.g., 200)
#   weather_entity:
#   weather_summary:

text_sensor:
  - platform: homeassistant
    entity_id: ${weather_entity | default("weather.home")}
    id: weather_condition
    on_value:
      then: !include {file: weather_icons_update.yaml, vars: {size: "${size}", id: weather_condition_icon, input_id: weather_condition}}

  - platform: homeassistant
    entity_id: ${weather_entity | default("weather.home")}
    attribute: temperature
    id: outdoor_temperature
    on_value:
      then:
        # Update weather_condition
        - lvgl.label.update:
            id: weather_temperature_today
            text: !lambda |-
              // outdoor_temperature is a text_sensor here, so parse
              float t = atof(id(outdoor_temperature).state.c_str());
              int ti = (int) lroundf(t);
              char buf[8];
              snprintf(buf, sizeof(buf), "%dÂ°", ti);
              return std::string(buf);

  - platform: homeassistant
    entity_id: ${weather_summary}
    id: weather_summary
    on_value:
      then:
        # Update weather summary
        - lvgl.label.update:
            id: weather_summary_today
            text:
              format: "%s"
              args: ['id(weather_summary).state.c_str()']


# Weather icons - included automatically
image:
  rgb565:
    alpha_channel:
      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/nt_clear.svg
        id: clear_night_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/cloudy.svg
        id: cloudy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/tstorms.svg
        id: exceptional_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/fog.svg
        id: fog_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/sleet.svg
        id: hail_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/chancetstorms.svg
        id: lightning_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/tstorms.svg
        id: lightning_rainy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/partlycloudy.svg
        id: partlycloudy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/rain.svg
        id: pouring_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/chancerain.svg
        id: rainy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/snow.svg
        id: snowy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/chancesleet.svg
        id: snowy_rainy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/sunny.svg
        id: sunny_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/windy.svg
        id: windy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/unknown.svg
        id: unknown_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/circle-slash.svg
        id: unavailable_${size}
        resize: ${size}x${size}
