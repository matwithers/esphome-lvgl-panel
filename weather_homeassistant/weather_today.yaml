---
# Weather for today from Home Assistant
#
# vars:
#   size: icon size (e.g., 200)
#   weather_entity:
#   weather_summary:

text_sensor:
  - platform: homeassistant
    entity_id: ${weather_entity | default("weather.home")}
    id: weather_condition
    on_value:
      then: !include {file: weather_icons_update.yaml, vars: {size: "${size}", id: weather_condition_icon, input_id: weather_condition}}

  - platform: homeassistant
    entity_id: ${weather_entity | default("weather.home")}
    attribute: temperature
    id: outdoor_temperature
    on_value:
      then:
        # Update weather_condition
        - lvgl.label.update:
            id: weather_temperature_today
            text: !lambda |-
              // outdoor_temperature is a text_sensor here, so parse
              float t = atof(id(outdoor_temperature).state.c_str());
              int ti = (int) lroundf(t);
              char buf[8];
              snprintf(buf, sizeof(buf), "%dÂ°", ti);
              return std::string(buf);

# Weather icons - included automatically
image:
  rgb565:
    alpha_channel:
      - file: esphome-lvgl-panel/modules/weather/assets/images/wi-night-clear.svg
        id: now_clear_night_${size}
        resize: ${size}x${size}

      - file: esphome-lvgl-panel/modules/weather/assets/images/wi-cloudy.svg
        id: now_cloudy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/tstorms.svg
        id: now_exceptional_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/fog.svg
        id: now_fog_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/sleet.svg
        id: now_hail_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/chancetstorms.svg
        id: now_lightning_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/tstorms.svg
        id: now_lightning_rainy_${size}
        resize: ${size}x${size}

      - file: esphome-lvgl-panel/modules/weather/assets/images/wi-day-cloudy.svg
        id: now_partlycloudy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/rain.svg
        id: now_pouring_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/chancerain.svg
        id: now_rainy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/snow.svg
        id: now_snowy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/chancesleet.svg
        id: now_snowy_rainy_${size}
        resize: ${size}x${size}

      - file: esphome-lvgl-panel/modules/weather/assets/images/wi-day-sunny.svg
        id: now_sunny_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/windy.svg
        id: now_windy_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/unknown.svg
        id: now_unknown_${size}
        resize: ${size}x${size}

      - file: esphome-modular-lvgl-buttons/weather_homeassistant/assets/images/circle-slash.svg
        id: now_unavailable_${size}
        resize: ${size}x${size}
